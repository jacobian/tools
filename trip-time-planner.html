<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Hiking Trip Planner</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/alpinejs/3.13.0/cdn.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/htmx/1.9.6/htmx.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-gray-100 font-sans">
    <div class="container mx-auto px-4 py-8" x-data="tripPlanner()">
      <h1 class="text-3xl font-bold text-center text-green-800 mb-6">Trip Planner</h1>

      <div class="bg-white rounded-lg shadow-lg p-6 mb-6">

        <table class="w-full mb-4">
          <thead>
            <tr class="bg-green-100 text-left">
              <th class="px-4 py-2 rounded-tl-md">Leg #</th>
              <th class="px-4 py-2">Travel Method</th>
              <th class="px-4 py-2">Distance (miles)</th>
              <th class="px-4 py-2">Elevation Gain (ft)</th>
              <th class="px-4 py-2 rounded-tr-md">Actions</th>
            </tr>
          </thead>
          <tbody>
            <template x-for="(leg, index) in legs" :key="index">
              <tr :class="index % 2 === 0 ? 'bg-gray-50' : 'bg-white'">
                <td class="px-4 py-2" x-text="index + 1"></td>
                <td class="px-4 py-2">
                  <select
                    x-model="leg.method"
                    class="w-full px-2 py-1 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-green-500"
                  >
                    <option value="hike">Hike</option>
                    <option value="float">Float</option>
                    <option value="xc">Cross Country</option>
                  </select>
                </td>
                <td class="px-4 py-2">
                  <input
                    type="number"
                    x-model="leg.distance"
                    min="0"
                    step="0.1"
                    class="w-full px-2 py-1 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-green-500"
                  />
                </td>
                <td class="px-4 py-2">
                  <input
                    type="number"
                    x-model="leg.elevationGain"
                    min="0"
                    class="w-full px-2 py-1 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-green-500"
                  />
                </td>
                <td class="px-4 py-2 text-right">
                  <button
                    @click="removeLeg(index)"
                    class="bg-red-200 hover:bg-red-400 text-white px-4 py-2 rounded-md transition"
                  >
                    ❌
                  </button>
                </td>
              </tr>
            </template>
          </tbody>
          <tfoot>
            <tr>
              <td colspan="5" class="px-4 py-2 text-right">
                <button
                  @click="addLeg()"
                  class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-md transition"
                >
                  ➕
                </button>
              </td>
            </tr>
          </tfoot>
        </table>

        <h2 class="text-xl font-semibold mb-4 text-green-700">
          Total:
          <span x-text="totalDistance.toFixed(1)">...</span> miles (<span x-text="methodBreakdown">...</span>), <span x-text="totalElevationGain">...</span> feet
          gain.
        </h2>

        <div class="mt-6">
          <button @click="clearTrip()" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-md transition">
            Reset
          </button>
        </div>
      </div>
    </div>

    <script>
      function tripPlanner() {
        return {
          tripName: "My Hiking Adventure",
          legs: [
            { method: "hike", distance: 3.5, elevationGain: 750 },
            { method: "float", distance: 2.0, elevationGain: 0 },
          ],

          addLeg() {
            this.legs.push({ method: "hike", distance: 0, elevationGain: 0 });
          },

          removeLeg(index) {
            this.legs.splice(index, 1);
          },

          get totalDistance() {
            return this.legs.reduce((sum, leg) => sum + parseFloat(leg.distance || 0), 0);
          },

          get totalElevationGain() {
            return this.legs.reduce((sum, leg) => sum + parseInt(leg.elevationGain || 0), 0);
          },

          get methodBreakdown() {
            const methods = {};
            this.legs.forEach((leg) => {
              if (!methods[leg.method]) {
                methods[leg.method] = 0;
              }
              methods[leg.method] += parseFloat(leg.distance || 0);
            });

            let breakdown = [];
            for (const [method, distance] of Object.entries(methods)) {
              const methodName = method.charAt(0).toUpperCase() + method.slice(1);
              breakdown.push(`${distance.toFixed(1)} ${methodName.toLowerCase()}`);
            }
            return breakdown.join(", ");
          },

          saveTrip() {
            const tripData = {
              name: this.tripName,
              legs: this.legs,
              totalDistance: this.totalDistance,
              totalElevationGain: this.totalElevationGain,
            };

            localStorage.setItem("savedTrip", JSON.stringify(tripData));
            alert("Trip saved successfully!");
          },

          clearTrip() {
            if (confirm("Are you sure you want to clear all trip data?")) {
              this.legs = [];
              localStorage.removeItem("savedTrip");
            }
          },

          init() {
            const savedTrip = localStorage.getItem("savedTrip");
            if (savedTrip) {
              const tripData = JSON.parse(savedTrip);
              this.tripName = tripData.name;
              this.legs = tripData.legs;
            }
          },
        };
      }
    </script>
  </body>
</html>
